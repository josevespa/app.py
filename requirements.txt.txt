import streamlit as st

def generador_de_prompts(
    rol_gpt,
    objetivo,
    formato_salida="texto",
    ejemplos=None,
    restricciones=None,
    tono="neutral",
    idioma="es"
):
    prompt = f"""Eres un {rol_gpt} diseñado para {objetivo}.

Reglas duras:
"""
    if restricciones:
        for i, r in enumerate(restricciones, 1):
            prompt += f"{i}. {r}\n"
    else:
        prompt += "1. Nunca compartas información privada.\n2. Sé coherente y claro.\n"

    prompt += f"\nFormato esperado de respuesta: {formato_salida}\nTono de comunicación: {tono}\nIdioma: {idioma}\n"

    if ejemplos:
        prompt += "\n--- Ejemplos ---\n"
        for ej in ejemplos:
            entrada = ej.get("input", "Pregunta no especificada")
            salida = ej.get("output", "Respuesta no especificada")
            prompt += f"\nUsuario: {entrada}\nGPT: {salida}\n"

    return prompt

# Interfaz Streamlit
st.set_page_config(page_title="Generador de Prompts GPT", layout="wide")
st.title("🧠 Generador de Prompts GPT")

rol = st.text_input("Rol del GPT", "asistente de soporte técnico")
objetivo = st.text_area("Objetivo del GPT", "reducir tiempos de atención resolviendo preguntas frecuentes")
formato = st.selectbox("Formato de salida", ["texto", "tabla", "json", "paso a paso"])
tono = st.selectbox("Tono de comunicación", ["neutral", "cercano", "formal", "técnico"])
idioma = st.selectbox("Idioma", ["es", "en"])

st.markdown("---")

st.subheader("📌 Restricciones")
restricciones_input = st.text_area("Escribe cada restricción separada por línea", "No dar soporte técnico avanzado\nNo redirigir fuera del sitio oficial")
restricciones = [r.strip() for r in restricciones_input.split("\n") if r.strip() != ""]

st.subheader("✨ Ejemplos")
ej_input = st.text_area("Ejemplos en formato 'input|output' por línea", "¿Cómo reinicio mi contraseña?|Ve a Configuración > Seguridad > Cambiar contraseña.\n¿Dónde veo mis facturas?|En el panel principal, haz clic en 'Facturación'.")
ejemplos = []
for linea in ej_input.split("\n"):
    if "|" in linea:
        entrada, salida = linea.split("|", 1)
        ejemplos.append({"input": entrada.strip(), "output": salida.strip()})

if st.button("🎯 Generar Prompt"):
    prompt = generador_de_prompts(
        rol, objetivo, formato, ejemplos, restricciones, tono, idioma
    )
    st.code(prompt, language="markdown")
