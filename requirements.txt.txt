import streamlit as st

def generador_de_prompts(
    rol_gpt,
    objetivo,
    formato_salida="texto",
    ejemplos=None,
    restricciones=None,
    tono="neutral",
    idioma="es"
):
    prompt = f"""Eres un {rol_gpt} diseÃ±ado para {objetivo}.

Reglas duras:
"""
    if restricciones:
        for i, r in enumerate(restricciones, 1):
            prompt += f"{i}. {r}\n"
    else:
        prompt += "1. Nunca compartas informaciÃ³n privada.\n2. SÃ© coherente y claro.\n"

    prompt += f"\nFormato esperado de respuesta: {formato_salida}\nTono de comunicaciÃ³n: {tono}\nIdioma: {idioma}\n"

    if ejemplos:
        prompt += "\n--- Ejemplos ---\n"
        for ej in ejemplos:
            entrada = ej.get("input", "Pregunta no especificada")
            salida = ej.get("output", "Respuesta no especificada")
            prompt += f"\nUsuario: {entrada}\nGPT: {salida}\n"

    return prompt

# Interfaz Streamlit
st.set_page_config(page_title="Generador de Prompts GPT", layout="wide")
st.title("ğŸ§  Generador de Prompts GPT")

rol = st.text_input("Rol del GPT", "asistente de soporte tÃ©cnico")
objetivo = st.text_area("Objetivo del GPT", "reducir tiempos de atenciÃ³n resolviendo preguntas frecuentes")
formato = st.selectbox("Formato de salida", ["texto", "tabla", "json", "paso a paso"])
tono = st.selectbox("Tono de comunicaciÃ³n", ["neutral", "cercano", "formal", "tÃ©cnico"])
idioma = st.selectbox("Idioma", ["es", "en"])

st.markdown("---")

st.subheader("ğŸ“Œ Restricciones")
restricciones_input = st.text_area("Escribe cada restricciÃ³n separada por lÃ­nea", "No dar soporte tÃ©cnico avanzado\nNo redirigir fuera del sitio oficial")
restricciones = [r.strip() for r in restricciones_input.split("\n") if r.strip() != ""]

st.subheader("âœ¨ Ejemplos")
ej_input = st.text_area("Ejemplos en formato 'input|output' por lÃ­nea", "Â¿CÃ³mo reinicio mi contraseÃ±a?|Ve a ConfiguraciÃ³n > Seguridad > Cambiar contraseÃ±a.\nÂ¿DÃ³nde veo mis facturas?|En el panel principal, haz clic en 'FacturaciÃ³n'.")
ejemplos = []
for linea in ej_input.split("\n"):
    if "|" in linea:
        entrada, salida = linea.split("|", 1)
        ejemplos.append({"input": entrada.strip(), "output": salida.strip()})

if st.button("ğŸ¯ Generar Prompt"):
    prompt = generador_de_prompts(
        rol, objetivo, formato, ejemplos, restricciones, tono, idioma
    )
    st.code(prompt, language="markdown")
